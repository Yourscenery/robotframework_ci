*** Settings ***
Resource          ../9ShareResource.txt

*** Keywords ***
http_post_return
    [Arguments]    ${url}    ${dicParams}    ${dicAssert}    ${returnKey}    ${contentType}=application/x-www-form-urlencoded
    ${dicResp}=    http_request_rockbottom    post    ${url}    ${dicParams}    ${dicAssert}    ${contentType}
    ${httpReturnVal}=    run keyword if    '${returnKey}'!='${none}'    http_request_returnval    ${dicResp}    ${returnKey}
    ...    ELSE IF    '${returnKey}'=='ALL' or '${returnKey}'=='All' or '${returnKey}'=='all'    set variable    ${dicResp}
    ...    ELSE    set variable    ${none}
    [Return]    ${httpReturnVal}

http_post
    [Arguments]    ${url}    ${dicParams}    ${dicAssert}    ${contentType}=application/x-www-form-urlencoded
    ${dicResp}=    http_request_rockbottom    post    ${url}    ${dicParams}    ${dicAssert}    ${contentType}

http_get_return
    [Arguments]    ${url}    ${dicParams}    ${dicAssert}    ${returnKey}    ${contentType}=application/x-www-form-urlencoded
    ${dicResp}=    http_request_rockbottom    get    ${url}    ${dicParams}    ${dicAssert}    ${contentType}
    ${httpReturnVal}=    run keyword if    '${returnKey}'!='${none}'    http_request_returnval    ${dicResp}    ${returnKey}
    ...    ELSE IF    '${returnKey}'=='ALL' or '${returnKey}'=='All' or '${returnKey}'=='all'    set variable    ${dicResp}
    ...    ELSE    set variable    ${none}
    [Return]    ${httpReturnVal}

http_get
    [Arguments]    ${url}    ${dicParams}    ${dicAssert}    ${contentType}=application/x-www-form-urlencoded
    ${dicResp}=    http_request_rockbottom    get    ${url}    ${dicParams}    ${dicAssert}    ${contentType}

http_put_return
    [Arguments]    ${url}    ${dicParams}    ${dicAssert}    ${returnKey}    ${contentType}=application/x-www-form-urlencoded
    ${dicResp}=    http_request_rockbottom    put    ${url}    ${dicParams}    ${dicAssert}    ${contentType}
    ${httpReturnVal}=    run keyword if    '${returnKey}'!='${none}'    http_request_returnval    ${dicResp}    ${returnKey}
    ...    ELSE IF    '${returnKey}'=='ALL' or '${returnKey}'=='All' or '${returnKey}'=='all'    set variable    ${dicResp}
    ...    ELSE    set variable    ${none}
    [Return]    ${httpReturnVal}

http_put
    [Arguments]    ${url}    ${dicParams}    ${dicAssert}    ${contentType}=application/x-www-form-urlencoded
    ${dicResp}=    http_request_rockbottom    put    ${url}    ${dicParams}    ${dicAssert}    ${contentType}

http_delete_return
    [Arguments]    ${url}    ${dicParams}    ${dicAssert}    ${returnKey}    ${contentType}=application/x-www-form-urlencoded
    ${dicResp}=    http_request_rockbottom    delete    ${url}    ${dicParams}    ${dicAssert}    ${contentType}
    ${httpReturnVal}=    run keyword if    '${returnKey}'!='${none}'    http_request_returnval    ${dicResp}    ${returnKey}
    ...    ELSE IF    '${returnKey}'=='ALL' or '${returnKey}'=='All' or '${returnKey}'=='all'    set variable    ${dicResp}
    ...    ELSE    set variable    ${none}
    [Return]    ${httpReturnVal}

http_delete
    [Arguments]    ${url}    ${dicParams}    ${dicAssert}    ${contentType}=application/x-www-form-urlencoded
    ${dicResp}=    http_request_rockbottom    delete    ${url}    ${dicParams}    ${dicAssert}    ${contentType}

http_request_rockbottom
    [Arguments]    ${requestType}    ${url}    ${dicParams}    ${dicAssert}    ${contentType}=application/x-www-form-urlencoded
    [Documentation]    returnKey=key.key.key变量dicParams为空时，传${none}
    ...    dicAssert判断message（字符串）时,走should be equal as strings逻辑；判断total（digit）时，走should be true逻辑
    log    ---开始${requestType}请求---${url}---${dicParams}---${dicAssert}
    ${header}    create dictionary    Content-Type=${contentType}    Authorization=${G_AUTHORIZATION}
    create session    ener    ${G_IP}
    #请求类型判断
    ${response}=    run keyword if    '${requestType}'=='post'    post request    ener    ${url}    data=${dicParams}
    ...    headers=${header}
    ...    ELSE IF    '${requestType}'=='get'    get request    ener    ${url}    params=${dicParams}
    ...    headers=${header}
    ...    ELSE IF    '${requestType}'=='put'    put request    ener    ${url}    data=${dicParams}
    ...    headers=${header}
    ...    ELSE IF    '${requestType}'=='delete'    delete request    ener    ${url}    data=${dicParams}
    ...    headers=${header}
    ...    ELSE    fail    ${requestType}不在'post','get'中，目前只有'post','get','put','delete'
    log    ---结束${requestType}请求---开始断言---
    should be equal as integers    ${response.status_code}    200
    log    RESPONSEURL${response.url}
    log    RESPONSETEXT${response.text}
    ${dicResp}    set variable    ${response.json()}
    @{assertKey}    get dictionary keys    ${dicAssert}
    : FOR    ${key}    IN    @{assertKey}
    \    ${valType}    Diy Judge Val Type    ${dicAssert}[${key}]
    \    ${assertVal}    set variable    ${dicAssert}[${key}]
    \    ${respVal}    set variable    ${dicResp}[${key}]
    \    run keyword if    '${valType}'=='True'    should be true    ${assertVal}<=${respVal}    msg=数字应答的值【${respVal}】要大于等于【${assertVal}】才通过
    \    ...    ELSE    Should be equal as strings    ${respVal}    ${assertVal}    msg=应答的值【${respVal}】要等于【${assertVal}】才通过
    log    ---断言结束----
    [Return]    ${dicResp}

http_request_returnval
    [Arguments]    ${dicResp}    ${returnKey}
    @{splitKey}    split string    ${returnKey}    .
    : FOR    ${key}    IN    @{splitKey}
    \    ${dicResp}    set variable    ${dicResp}[${key}]
    \    ${bRespBeNone}    Diy Judge Two Val Are Equal    ${dicResp}    ${none}    msg=【dicResp】等于【none】退出http_request_returnval循环    #判断dicResp是否为none
    \    exit for loop if    ${bRespBeNone}
    log    ${dicResp}
    [Return]    ${dicResp}
